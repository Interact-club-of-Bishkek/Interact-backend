<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>История действий администраторов</title>

<style>
body { font-family: Inter, sans-serif; background: #eef1f5; margin:0; padding:30px 40px; }
h1 { font-size: 32px; margin-bottom: 25px; }

.log {
    background: #fff;
    border-radius: 14px;
    padding: 20px 24px;
    margin-bottom: 18px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.08);
    cursor: pointer;
    border-left: 6px solid #4a90e2;
    transition: background 0.2s, border-left 0.2s;
}
.log:hover { background: #f9fafc; }

.header { display: flex; justify-content: space-between; align-items: center; }
.timestamp { font-size: 14px; color: #777; }

.details { margin-top: 14px; display: none; animation: fadeIn 0.25s ease; }
.diff-table { width:100%; border-collapse: collapse; margin-top:12px; }
.diff-table th { padding:8px; background:#f1f4f8; border-radius:6px; text-align:left; }
.diff-table td { padding:8px; vertical-align:top; }

.old { color:#c0392b; font-weight:600; }
.new { color:#27ae60; font-weight:600; }
.field-name { font-weight:600; color:#34495e; }

/* Цвета действий админа */
.action-login { color:#27ae60; font-weight:600; border-left:6px solid #27ae60; padding-left:18px; }
.action-logout { color:#c0392b; font-weight:600; border-left:6px solid #c0392b; padding-left:18px; }
.action-page { color:#2980b9; font-weight:600; border-left:6px solid #2980b9; padding-left:18px; }

.action-create { color:#27ae60; font-weight:600; border-left:6px solid #27ae60; padding-left:18px; }
.action-update { color:#e67e22; font-weight:600; border-left:6px solid #e67e22; padding-left:18px; }
.action-delete { color:#c0392b; font-weight:600; border-left:6px solid #c0392b; padding-left:18px; }
</style>
</head>
<body>

<h1>История действий администраторов</h1>

{% for log in logs %}
<div class="log" onclick="toggleDetails({{ log.id }})">
    <div class="header">
        <div>
            {% if "logged in" in log.object_repr %}
                <span class="action-login">{{ log.user }}</span> вошёл в админку
            {% elif "logged out" in log.object_repr %}
                <span class="action-logout">{{ log.user }}</span> вышел из админки
            {% elif "Admin page view" in log.object_repr %}
                <span class="action-page">{{ log.user }}</span> перешёл на страницу "{{ log.change_message|default:"—" }}"
            {% else %}
                {% if log.action_flag == 1 %}
                    <span class="action-create">{{ log.user }}</span> создал объект
                {% elif log.action_flag == 2 %}
                    <span class="action-update">{{ log.user }}</span> изменил объект
                {% elif log.action_flag == 3 %}
                    <span class="action-delete">{{ log.user }}</span> удалил объект
                {% else %}
                    {{ log.user }}
                {% endif %}
                <strong>{{ log.model_name }}:</strong> {{ log.object_repr }}{% if log.object_id %} (ID {{ log.object_id }}){% endif %}
            {% endif %}
        </div>
        <div class="timestamp">{{ log.action_time|date:"j F Y г. H:i" }}</div>
    </div>

    <div id="details-{{ log.id }}" class="details">
        {% if log.changes %}
        <table class="diff-table">
            <tr><th>Поле</th><th>Было</th><th>Стало</th></tr>
            {% for field, diff in log.changes.items %}
            <tr>
                <td class="field-name">{{ field }}</td>
                <td class="old">{{ diff.old|default:"-" }}</td>
                <td class="new">{{ diff.new|default:"изменено" }}</td>
            </tr>
            {% endfor %}
        </table>
        {% else %}
            <div style="color:#555; font-style:italic;">Изменений нет.</div>
        {% endif %}
    </div>
</div>
{% empty %}
<div>Пока нет логов.</div>
{% endfor %}

<script>
function toggleDetails(id) {
    let el = document.getElementById("details-" + id);
    el.style.display = (el.style.display === "block") ? "none" : "block";
}
</script>

</body>
</html>
